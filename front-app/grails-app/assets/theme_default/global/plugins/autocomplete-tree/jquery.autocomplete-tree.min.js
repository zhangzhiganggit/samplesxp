/**
*  Ajax Autocomplete-tree for jQuery, version 0.0.3
*  (c) 2014 Ricardo Momm
*
*  Ajax Autocomplete-tree for jQuery is freely distributable under the terms of an MIT-style license.
*  For details, see the web site: https://github.com/ricardomomm/jquery.autocomplete-tree
*/
!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):a("object"==typeof exports&&"function"==typeof require?require("jquery"):jQuery)}(function(a){"use strict";function b(b,c){var d=function(){},e=this,f={load:null,getValue:function(a){return a.value},getText:function(a){return a.text},getChildCount:function(a){return a.childrenQuantity||0},select:d,cache:!1,debug:!1,canSelectParent:!1,canSelectParentInChildList:!0,showParentInChildList:!0,showBackButton:!0,leftMargin:15,topMargin:5,treeSeparator:" » ",maxVisibleItens:5,animationDuration:200,showPathTooltip:!0,backLabel:"Back",rightArrowTemplate:function(){return" » "}};e.element=b,e.el=a(b),e.prefix=b.id,e.container=null,e.options=a.extend({},f,c),e.console=window.console||d,e.searching=!1,e.initialize()}var c={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40,BCKSPC:8,DELETE:46};a.autocompleteTree=b,b.prototype={onKeyPress:function(a){switch(a.which){case c.LEFT:case c.RIGHT:case c.UP:case c.DOWN:return void this.navigate(a.which);case c.RETURN:return void this.selectItem();case c.ESC:this.hideAllItens();break;case c.TAB:return void this.hideAllItens();default:return}a.stopImmediatePropagation(),a.preventDefault()},onKeyUp:function(a){this.searching&&!this.el.val()?this.endSearch():!this.searching&&this.el.val()&&this.beginSearch()},beginSearch:function(){if(!this.searching||!this.el.val()){if(this.searching)return void this.endSearch();this.debug("Begin search"),this.searching=!0}},endSearch:function(){this.debug("End search"),this.searching=!1},onBodyClick:function(){this.isVisible&&this.hideAllItens()},debug:function(a){if(this.options.debug&&arguments.length>=1){for(var b=1;b<arguments.length;b++)a=a.replace("{"+(b-1)+"}",arguments[b]);this.console.debug(a)}},getItemValue:function(a){return this.options.getValue(a)},getItemText:function(a){return this.options.getText(a)},getItemChildCount:function(a){return this.options.getChildCount(a)},showContainer:function(){if(null===this.container){var b=this.el.offset();this.container=a("<div id='"+this.prefix+"-act-container' class='act-container'></div>").css({position:"absolute",left:b.left+"px",top:b.top+this.el.outerHeight()+"px",width:this.el.width()+"px"}).appendTo("body").show()}else this.container.show()},refreshContainerSize:function(b){var c=b.children("li");if(c.length<=this.options.maxVisibleItens)this.container.css({height:b.outerHeight()+"px",width:this.el.outerWidth()+"px"});else{var d=0,e=this;c.each(function(b,c){b<e.options.maxVisibleItens&&(d+=a(c).outerHeight())}),this.container.css({height:d+"px",width:this.el.outerWidth()+("scroll"===this.el.css("overflow-y")?0:15)+"px","overflow-y":"scroll"})}},ensureItemIsVisibile:function(a){this.isHiddenByScroll(a)&&this.container.animate({scrollTop:a.offset().top-this.container.offset().top},"fast")},isHiddenByScroll:function(a){if(null===a)return!1;var b=this.container.scrollTop(),c=b+this.container.height(),d=a.offset().top-this.container.offset().top+b,e=d+a.height();return b>e||e>c||b>d||d>c},showItem:function(a){if(a&&!a.is(":visible")){this.container.show();var b=this.selectedItem&&this.selectedItem.length>0?this.selectedItem.offset().left+this.selectedItem.outerWidth():0;a.css({position:"absolute",left:b+"px",top:"0px",width:(this.selectedItem&&this.selectedItem.length>0?this.selectedItem.outerWidth():this.el.outerWidth())+"px"}).show(),this.refreshContainerSize(a),this.visibleItem&&this.visibleItem.length>0&&this.slideLeft(this.visibleItem,a),this.visibleItem=a,this.selectedItem=null,this.isVisible=!0,this.focusNextItem(a)}},hideItem:function(){if(this.visibleItem&&0!==this.visibleItem.length&&this.visibleItem.is(":visible")){var b=this.visibleItem;this.selectedItem&&this.selectedItem.toggleClass("act-selected");var c=b.data("parent");c?(this.selectedItem=a("#"+this.prefix+"-son-"+c),this.visibleItem=a("#"+this.prefix+"-sons-of-"+this.selectedItem.data("parent")),this.refreshContainerSize(this.visibleItem),this.slideRight(b,this.visibleItem)):(this.visibleItem.hide(),this.container.hide(),this.selectedItem=this.visibleItem=null,this.isVisible=!1),this.showPathTooltip()}},slideLeft:function(a,b){b.animate({left:"0px"},{duration:this.options.animationDuration,queue:!1}),a.animate({left:-1*a.outerWidth()+"px"},{duration:this.options.animationDuration,queue:!1})},slideRight:function(b,c){b.animate({left:b.outerWidth()+"px"},{duration:this.options.animationDuration,queue:!1,complete:function(){a(this).hide()}}),c.animate({left:"0px"},{duration:this.options.animationDuration,queue:!1})},loadItems:function(b){var c=this.getCachedItems(b);c?this.loadItemsCompleted(b,c):(this.debug("Loading itens sons of {0}",b),this.beginLoadItems(b),this.options.load({term:null,parent:b},a.proxy(function(a){this.endLoadItems(b),this.loadItemsCompleted(b,a)},this)))},beginLoadItems:function(){},endLoadItems:function(){},loadItemsCompleted:function(a,b){if(b){this.options.cache&&this.el.data("sons-of-"+a,b),this.debug("Result: {0}",b.toString());var c=this.createItemsContainer(a,b);this.showItem(c)}else this.debug("No child itens found")},getCachedItems:function(a){if(this.options.cache){var b=this.el.data("sons-of-"+a);if(b)return this.debug("Loading itens sons of {0} from cache",a),b}return null},createItemsContainer:function(b,c){var d=a("#"+this.prefix+"-sons-of-"+b);if(0===d.length){if(this.showContainer(),this.debug("Generating {0} container html",b),d=a("<ul id='"+this.prefix+"-sons-of-"+b+"' data-parent='"+b+"' class='act-menu' ></ul>").appendTo(this.container),null!==b){if(this.options.showBackButton){var e=this.createBackButton(b);d.append(e)}if(this.options.showParentInChildList&&this.options.canSelectParentInChildList){var f=a("#"+this.prefix+"-son-"+b).data("item"),g=this.createSelectableParentItem(f);d.append(g)}}var h=this;a.each(c,function(){h.debug("Generating child {0}",this.toString());var a=h.createItem(b,this);d.append(a)})}return d},createBackButton:function(b){var c=this,d=a("<li id='"+this.prefix+"-back-"+b+"' data-parent='"+b+"' class='act-back act-unselectable'><span>"+this.options.backLabel+"</span></li>").click(function(a){c.selectItem(),a.stopImmediatePropagation(),a.preventDefault()}).hover(function(){c.selectedItem&&c.selectedItem.removeClass("act-selected"),c.selectedItem=a(this).addClass("act-selected")},function(){c.selectedItem&&c.selectedItem.removeClass("act-selected"),a(this).removeClass("act-selected"),c.selectedItem=null});return d},createSelectableParentItem:function(b){var c=this,d=this.getItemValue(b),e=a("#"+this.prefix+"-son-"+d),f=a("<li id='"+this.prefix+"-parent-"+d+"' data-parent='"+e.data("parent")+"' data-val='"+d+"' ><span>"+this.getItemText(b)+"</span></li>");return f.data("item",b).addClass("act-selectableParent").click(function(a){c.selectItem(),a.stopImmediatePropagation(),a.preventDefault()}).hover(function(){c.selectedItem&&c.selectedItem.removeClass("act-selected"),c.selectedItem=a(this).addClass("act-selected")},function(){c.selectedItem&&c.selectedItem.removeClass("act-selected"),a(this).removeClass("act-selected"),c.selectedItem=null}),f},createItem:function(b,c){var d=this,e=this.getItemValue(c),f=a("<li id='"+this.prefix+"-son-"+e+"' data-parent='"+b+"'  data-val='"+e+"' ><span>"+this.getItemText(c)+"</span></li>");return f.data("item",c).click(function(b){var c=d.getItemChildCount(a(this).data("item"));c>0&&d.options.canSelectParent||0>=c?d.selectItem():c>0&&d.loadItems(a(this).data("val")),b.stopImmediatePropagation(),b.preventDefault()}).hover(function(){d.selectedItem&&d.selectedItem.removeClass("act-selected"),d.selectedItem=a(this).addClass("act-selected")},function(){d.selectedItem&&d.selectedItem.removeClass("act-selected"),a(this).removeClass("act-selected"),d.selectedItem=null}),this.getItemChildCount(c)>0&&(f.addClass("act-menu-hasChildren"),this.options.canSelectParent||f.addClass("act-unselectable"),a('<span class="pull-right">'+this.options.rightArrowTemplate(c)+"</span>").insertAfter(f.find("span"))),f},focusNextItem:function(a){var b=a.children("li:first");this.selectedItem&&(this.selectedItem.toggleClass("act-selected"),b=this.selectedItem.next(),0===b.length&&(b=a.children("li:first"))),b.toggleClass("act-selected"),this.selectedItem=b,this.ensureItemIsVisibile(this.selectedItem),this.showPathTooltip()},focusPreviousItem:function(a){if(this.selectedItem){this.selectedItem.toggleClass("act-selected");var b=this.selectedItem.prev();0===b.length&&(b=a.children("li:last")),b.toggleClass("act-selected"),this.selectedItem=b,this.ensureItemIsVisibile(this.selectedItem),this.showPathTooltip()}else this.hideItem()},showPathTooltip:function(){var b=a("#"+this.prefix+"-act-pathTooltip");if(0===b.length&&(b=a("<div id='"+this.prefix+"-act-pathTooltip' class='act-pathTooltip' style='display:none'><div>"),b.appendTo("body")),b.hide(),b.text(""),this.options.showPathTooltip&&this.selectedItem&&!this.selectedItem.is(".act-back")){var c=this.selectedItem,d="";do d=c.find("span:first").text()+d,d=this.options.treeSeparator+d,c=a("#"+this.prefix+"-son-"+c.data("parent"));while(c.length>0);b.text(d),b.show()}},selectItem:function(){if(this.isVisible&&this.selectedItem)if(this.selectedItem.is(".act-unselectable"))this.selectedItem.is(".act-menu-hasChildren")?this.loadItems(this.selectedItem.data("val")):this.selectedItem.is(".act-back")&&this.hideItem();else{var b=this.selectedItem.data("item");this.el.val(this.getItemText(b)),this.container.hide(),this.options.showPathTooltip&&a("#"+this.prefix+"-act-pathTooltip").hide(),this.isVisible=!1,this.options.select.apply(this.el,[b])}},hideAllItens:function(){for(;this.isVisible;)this.hideItem()},openChildItens:function(){if(this.isVisible&&this.selectedItem&&!this.selectedItem.is(".act-back")){var a=this.selectedItem.data("item");if(this.getItemChildCount(a)>0){var b=this.getItemValue(a);this.loadItems(b)}}},navigate:function(a){switch(a){case c.DOWN:var b=this.visibleItem;this.visibleItem?this.isVisible?this.focusNextItem(b):(this.isVisible=!0,this.container.show()):this.loadItems(null);break;case c.UP:this.isVisible&&this.focusPreviousItem(this.visibleItem);break;case c.LEFT:this.hideItem();break;case c.RIGHT:this.openChildItens()}},dispose:function(){this.el.off(".autocompletetree").removeData("autocompletetree"),this.container.remove(),this.options.showPathTooltip&&a("#"+this.prefix+"-act-pathTooltip").remove()},initialize:function(){this.element.setAttribute("autocomplete","off");var b=this;this.el.on("keydown.autocompletetree",function(a){b.onKeyPress(a)}),this.el.on("keyup.autocompletetree",function(a){b.onKeyUp(a)}),a("body").on("click",function(a){b.onBodyClick(a)}),this.debug("AutoComplete-Tree initialized")}},a.fn.autocompleteTree=function(c,d){var e="autocompletetree";return 0===arguments.length?this.first().data(e):this.each(function(){var f=a(this),g=f.data(e);"string"==typeof c?g&&"function"==typeof g[c]&&g[c](d):(g&&g.dispose&&g.dispose(),g=new b(this,c),f.data(e,g))})}});